<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeirdForums</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    #postForm, .post {
      background-color: #222;
      border: 1px solid #333;
      padding: 10px;
      margin: 10px;
      border-radius: 8px;
    }
    input, textarea, button {
      background-color: #333;
      color: #eee;
      border: none;
      padding: 5px;
      margin: 5px 0;
      width: 100%;
    }
    .btn {
      background-color: #444;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #555;
    }
    .replies {
      margin-left: 20px;
    }
    .controls {
      display: flex;
      gap: 5px;
    }
    .confirm-box {
      margin-top: 5px;
      background-color: #333;
      padding: 5px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="postForm">
    <textarea id="postContent" placeholder="What's on your mind?"></textarea>
    <input type="text" id="imageURL" placeholder="Imgur Image URL (optional)" />
    <button onclick="createPost()" class="btn">Post</button>
  </div>

  <div id="postsContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBBwOMD194nKq0SD3j2_OAHboXdi6qOdGk",
  authDomain: "weirdforums-f8a45.firebaseapp.com",
  projectId: "weirdforums-f8a45",
  storageBucket: "weirdforums-f8a45.firebasestorage.app",
  messagingSenderId: "816710038730",
  appId: "1:816710038730:web:4a4de7f70c8813d162b033",
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const postsCol = collection(db, "posts");
async function createPost() {
  const content = document.getElementById("postContent").value;
  const image = document.getElementById("imageURL").value;
  if (!content.trim()) return;
  await addDoc(postsCol, {
    content,
    image,
    timestamp: Date.now(),
    likes: 0,
    dislikes: 0,
    replies: []
  });
  document.getElementById("postContent").value = "";
  document.getElementById("imageURL").value = "";
}
window.createPost = createPost;
    async function createPost() {
      const content = document.getElementById("postContent").value;
      const image = document.getElementById("imageURL").value;
      if (!content.trim()) return;
      await addDoc(postsCol, {
        content,
        image,
        timestamp: Date.now(),
        likes: 0,
        dislikes: 0,
        replies: []
      });
      document.getElementById("postContent").value = "";
      document.getElementById("imageURL").value = "";
    }

    function renderPosts(snapshot) {
      const container = document.getElementById("postsContainer");
      container.innerHTML = "";
      snapshot.docs.sort((a,b)=>b.data().timestamp - a.data().timestamp).forEach(docSnap => {
        const post = docSnap.data();
        const postDiv = document.createElement("div");
        postDiv.className = "post";
        postDiv.innerHTML = `
          <p>${post.content}</p>
          ${post.image ? `<img src="${post.image}" style="max-width:100%; border-radius:6px;" />` : ""}
          <div class="controls">
            <button class="btn" onclick="likePost('${docSnap.id}')">üëç ${post.likes}</button>
            <button class="btn" onclick="dislikePost('${docSnap.id}')">üëé ${post.dislikes}</button>
            <button class="btn" onclick="showReply('${docSnap.id}')">Reply</button>
            <button class="btn" onclick="showEdit('${docSnap.id}', \`${post.content}\`)" >Edit</button>
            <button class="btn" onclick="showDelete('${docSnap.id}')">Delete</button>
          </div>
          <div class="replies">${(post.replies || []).map(r => `<div class='post'><p>${r}</p></div>`).join("")}</div>
          <div id="confirm-${docSnap.id}"></div>
        `;
        container.appendChild(postDiv);
      });
    }

    onSnapshot(postsCol, renderPosts);

    window.likePost = async (id) => {
      const ref = doc(db, "posts", id);
      const snap = await getDocs(postsCol);
      let post = snap.docs.find(d => d.id === id).data();
      await updateDoc(ref, { likes: (post.likes || 0) + 1 });
    }

    window.dislikePost = async (id) => {
      const ref = doc(db, "posts", id);
      const snap = await getDocs(postsCol);
      let post = snap.docs.find(d => d.id === id).data();
      await updateDoc(ref, { dislikes: (post.dislikes || 0) + 1 });
    }

    window.showReply = (id) => {
      const box = document.getElementById(`confirm-${id}`);
      box.innerHTML = `
        <div class='confirm-box'>
          <textarea id='reply-${id}' placeholder='Your reply'></textarea>
          <button class='btn' onclick='sendReply("${id}")'>Send</button>
        </div>`;
    }

    window.sendReply = async (id) => {
      const reply = document.getElementById(`reply-${id}`).value;
      if (!reply.trim()) return;
      const ref = doc(db, "posts", id);
      const snap = await getDocs(postsCol);
      const post = snap.docs.find(d => d.id === id).data();
      const replies = post.replies || [];
      replies.push(reply);
      await updateDoc(ref, { replies });
    }

    window.showEdit = (id, content) => {
      const box = document.getElementById(`confirm-${id}`);
      box.innerHTML = `
        <div class='confirm-box'>
          <textarea id='edit-${id}'>${content}</textarea>
          <button class='btn' onclick='confirmEdit("${id}")'>Save</button>
        </div>`;
    }

    window.confirmEdit = async (id) => {
      const content = document.getElementById(`edit-${id}`).value;
      const ref = doc(db, "posts", id);
      await updateDoc(ref, { content });
    }

    window.showDelete = (id) => {
      const box = document.getElementById(`confirm-${id}`);
      box.innerHTML = `
        <div class='confirm-box'>
          <p>Delete this post?</p>
          <button class='btn' onclick='confirmDelete("${id}")'>Yes</button>
        </div>`;
    }

    window.confirmDelete = async (id) => {
      await deleteDoc(doc(db, "posts", id));
    }
  </script>
</body>
</html>
